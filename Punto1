mkdir ~/modulo_parcial
cd ~/modulo_parcial


nano simple.c //Crea un archivo nano (editor de texto en la terminal, ya viene instalado en Linux)


#include <linux/init.h>         
#include <linux/module.h>     
#include <linux/kernel.h>    
#include <linux/gcd.h>        
#include <linux/jiffies.h>    
#include <linux/param.h>      
#include <linux/hash.h>      

static int __init simple_init(void) {
    unsigned long gcd_result = gcd(3300, 24); //Calcula el MCD entre 3300 y 24

    printk(KERN_INFO "Loading Kernel Module\n");
    printk(KERN_INFO "GOLDEN_RATIO_PRIME: %lu\n", GOLDEN_RATIO_PRIME);
    printk(KERN_INFO "HZ (ticks por segundo): %d\n", HZ);
    printk(KERN_INFO "Valor actual de jiffies: %lu\n", jiffies);
    printk(KERN_INFO "GCD(3300, 24) = %lu\n", gcd_result);
    return 0;
}

static void __exit simple_exit(void) {
    printk(KERN_INFO "Removing Kernel Module\n");
    printk(KERN_INFO "Final jiffies value: %lu\n", jiffies);

}

module_init(simple_init);
module_exit(simple_exit);

MODULE_LICENSE("GPL");
MODULE_DESCRIPTION("Simple Module");
MODULE_AUTHOR("Cristian_Fabian");

//GUARDAR Y SALIR CTR+O Y LUEGO CTR+X

nano makefile

obj-m += simple.o  //obj-m es objetos del modulo y le dice a make que compile el simple.c como un modulo de kernel .ko

all:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules //Va al directorio de instalación del kernel y compila el módulo de la carpeta actual

clean:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean //elimina archivos temporales de compilación

//GUARDAR Y SALIR CTR+O Y LUEGO CTR+X 

make //compila

sudo insmod simple.ko //insmod inserta un móudlo al kernel, en este caso el simple.ko

lsmod | grep simple //verifica si el módulo está activo

sudo dmesg | tail -20 //muestra las últimas 20 líneas de los mensajes del kernel, osea los printk y eso (tail por defecto muestra solo 10 creo)

sudo rmmod simple //remueve o descarga el módulo "simple" cargado

sudo dmesg | tail -20 //muestra el mensaje de simple_exit porque ya se descargo ese módulo

exit
